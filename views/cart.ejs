<!DOCTYPE HTML>
<html lang="zh-CN">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>index</title>
	<!-- Bootstrap -->
	<link href="css/bootstrap.css" rel="stylesheet">
	<link href="css/swiper.min.css" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet">

</head>

<body>
		<%-include('header') %>
	<div class="container nav-c clearfix">
		<div class="pull-left logo"><a href=""><img src="images/logo.png"></a></div>
		<ul class="pull-right nav-list clearfix">
			<li><a href="/index">Home</a></li>
			<li class="active"><a href="/productlist">产品</a></li>
			<li>
				<a href="/case">Solution</a><span class="phone-i"><i class="glyphicon glyphicon-menu-down"></i></span>
				<!-- <ul class="nav-down">
					<li><a href="/integrator">查找集成伙伴</a></li>
					<li><a href="/integrator">查找集成伙伴</a></li>
					<li><a href="/integrator">查找集成伙伴</a></li>
					<li><a href="/integrator">查找集成伙伴</a></li>
					<li><a href="/integrator">查找集成伙伴</a></li>
				</ul> -->
			</li>
			<li><a href="/support">Support</a></li>
			<li><a href="/video">Train</a></li>
			<li><a href="/contact">Contact</a></li>
			<li class="last"><a href="/integrator">Integrated partner</a></li>
		</ul>
		<button type="button" class="navbar-toggle collapsed">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
		</button>
	</div>
	<div class="container">
		<div class="car-tt"><span>我的购物车</span> 温馨提示：产品是否购买成功，以最终下单为准哦，请尽快结算</div>
		<div class="table-responsive">
			<table class="table table-bordered table-car">
				<thead>
					<tr>
						<th>
							<div class="check checkbox checkbox-car margin-no">
								<input value="all" type="checkbox"> 全选
							</div>
						</th>
						<th style="width: 250px;">产品名称</th>
						<th>产品配置</th>
						<th class="text-center">数量</th>
						<th class="text-center">重量/KG</th>
						<th class="text-center">价格/元</th>
						<th class="text-center">操作</th>
					</tr>
				</thead>
				<tbody>
					<%if(carts && carts.length > 0){ carts.forEach(function(child, index){ %>
					<tr>
						<td>
							<div class="check checkbox checkbox-xs">
								<input class="check2" value="<%=child.cid %>" type="checkbox">
							</div>
						</td>
						<td>
							<div class="car-box">
								<div class="car-img text-center"><img src="<%=child.product.imgs && child.product.imgs.length > 0 ? child.product.imgs[0] : 'images/car01.png' %>"></div>
								<div class="car-txt">
									<p>名称：
										<%=child.product.title %>
									</p>
									<p>货号：
										<%=child.product.identifier %>
									</p>
									<p>规格：
										<%=child.size %>
									</p>
								</div>
							</div>
						</td>
						<td>
							<ul class="car-list">
								<%if(child.parts && child.parts.length > 0){ child.parts.forEach(function(cd, ix){ %>
								<li>
									<%=cd.partName %>：
									<%=cd.name %>
								</li>
								<%})}%>
							</ul>
							<!-- <ul class="car-list">
								  <li>输送速度(m/min)：60</li>
								  <li>承载(kg/m)：20</li>
								  <li>电机(kw)：Nord0.75</li>
								  <li>电机电压(v)：AC380V/3Ph/50Hz</li>
								  <li>皮带类型：Siegling E8/2 U0</li>
								  <li>支腿高度（mm)：G5001/H345-445</li>
								  <li>护栏：单边GR80(H800mm)</li>
								  <li>光电：侧架上安装-经济型</li>
								  <li>阻挡装置：端部阻挡</li>
								  <li class="border-no">其它备注</li>
							  </ul> -->
						</td>
						<td class="text-center">
							<div class="car-number">
								<!-- <span>

								</span> -->
								<input id="<%=child.cid %>" class="qtyClass" style="text-align: center;width: 50px;" value="<%=child.qty %>" />
								<a role="button">更新</a>
							</div>
						</td>
						<td class="text-center">
							<%=child.weight || ''%>
						</td>
						<td class="text-center">￥
							<%=child.totalAmoumt %>
						</td>
						<td class="text-center"><a role="button" id="<%=child.cid %>" class="btn-remove">删除</a></td>
						<input hidden class="<%=child.cid %>" value="<%=child.totalAmoumt %>" />
					</tr>
					<%})} %>
					<!-- <tr>
		          <td>
					  <div class="checkbox checkbox-xs">
					      <input type="checkbox">
					  </div>
		          </td>
		          <td>
		          	<div class="car-box">
						<div class="car-img text-center"><img src="images/car01.png"></div>
						<div class="car-txt">
							<p>名称：D10-GC610 无动力输送机</p>
							<p>货号：GC61075656</p>
							<p>规格：517*2280</p>
						</div>
					</div>
		          </td>
		          <td>
					<ul class="car-list">
						<li>输送速度(m/min)：60</li>
						<li>承载(kg/m)：20</li>
						<li>电机(kw)：Nord0.75</li>
						<li>电机电压(v)：AC380V/3Ph/50Hz</li>
						<li>皮带类型：Siegling E8/2 U0</li>
						<li>支腿高度（mm)：G5001/H345-445</li>
						<li>护栏：单边GR80(H800mm)</li>
						<li>光电：侧架上安装-经济型</li>
						<li>阻挡装置：端部阻挡</li>
						<li class="border-no">其它备注</li>
					</ul>
		          </td>
		          <td class="text-center"><div class="car-number"><span>1</span><a role="button">更新</a></div></td>
		          <td class="text-center">500</td>
		          <td class="text-center">￥12500</td>
		          <td class="text-center"><a role="button" class="btn-remove">删除</a></td>
		        </tr>
		        <tr>
		          <td>
					  <div class="checkbox checkbox-xs">
					      <input type="checkbox">
					  </div>
		          </td>
		          <td>
		          	<div class="car-box">
						<div class="car-img text-center"><img src="images/car01.png"></div>
						<div class="car-txt">
							<p>名称：D10-GC610 无动力输送机</p>
							<p>货号：GC61075656</p>
							<p>规格：517*2280</p>
						</div>
					</div>
		          </td>
		          <td>
					<ul class="car-list">
						<li>输送速度(m/min)：60</li>
						<li>承载(kg/m)：20</li>
						<li>电机(kw)：Nord0.75</li>
						<li>电机电压(v)：AC380V/3Ph/50Hz</li>
						<li>皮带类型：Siegling E8/2 U0</li>
						<li>支腿高度（mm)：G5001/H345-445</li>
						<li>护栏：单边GR80(H800mm)</li>
						<li>光电：侧架上安装-经济型</li>
						<li>阻挡装置：端部阻挡</li>
						<li class="border-no">其它备注</li>
					</ul>
		          </td>
		          <td class="text-center"><div class="car-number"><span>1</span><a role="button">更新</a></div></td>
		          <td class="text-center">500</td>
		          <td class="text-center">￥12500</td>
		          <td class="text-center"><a role="button" class="btn-remove">删除</a></td>
		        </tr>
		        <tr>
		          <td>
					  <div class="checkbox checkbox-xs">
					      <input type="checkbox">
					  </div>
		          </td>
		          <td>
		          	<div class="car-box">
						<div class="car-img text-center"><img src="images/car01.png"></div>
						<div class="car-txt">
							<p>名称：D10-GC610 无动力输送机</p>
							<p>货号：GC61075656</p>
							<p>规格：517*2280</p>
						</div>
					</div>
		          </td>
		          <td>
					<ul class="car-list">
						<li>输送速度(m/min)：60</li>
						<li>承载(kg/m)：20</li>
						<li>电机(kw)：Nord0.75</li>
						<li>电机电压(v)：AC380V/3Ph/50Hz</li>
						<li>皮带类型：Siegling E8/2 U0</li>
						<li>支腿高度（mm)：G5001/H345-445</li>
						<li>护栏：单边GR80(H800mm)</li>
						<li>光电：侧架上安装-经济型</li>
						<li>阻挡装置：端部阻挡</li>
						<li class="border-no">其它备注</li>
					</ul>
		          </td>
		          <td class="text-center"><div class="car-number"><span>1</span><a role="button">更新</a></div></td>
		          <td class="text-center">500</td>
		          <td class="text-center">￥12500</td>
		          <td class="text-center"><a role="button" class="btn-remove">删除</a></td>
		        </tr> -->
				</tbody>
			</table>
		</div>
		<div class="car-bottom clearfix">
			<div class="pull-left">共<span>
					<%=carts.length %></span>件商品，已选择<span>0</span>件</div>
			<div class="pull-right">总价：<span class="totalAmount">¥0</span></div>
		</div>
		<div class="text-right"><button type="button" class="btn btn-car">去结算</button></div>
	</div>
	<div class="bottom">
		<div class="container">
			<div class="row">
						<div class="bottom-tt">customer service</div>
						<ul class="bottom-list">
							<li><a href="/register">Create an Account</a></li>
							<li><a href="">Join integration partners</a></li>
							<li><a href="/integrator">Find integration partners</a></li>
							<li><a href="/productlist">Online order </a></li>
							<li><a href="/support">Support</a></li>
						</ul>
					</div>
				</div>
				<div class="col-xs-3">
					<div class="dis-table">
						<div class="bottom-tt">Information Center</div>
						<ul class="bottom-list">
							<li><a href="/policy">Privacy policy</a></li>
							<li><a href="">Terms of Use</a></li>
						</ul>
					</div>
				</div>

				<div class="col-xs-3 pull-right">
					<div class="footer-link">
						<a href=""><img src="images/footer03.png"></a>
						<a href=""><img src="images/footer04.png"></a>
						<a href=""><img src="images/footer05.png"></a>
					</div>
					<div class="bottom-phone">400-880-5180</div>
					<div class="bottom-phone bottom-phone-b">7F, software building 461, Hong Cao Road, Xuhui District, Shanghai</div>
				</div>
			</div>
		</div>
	</div>
	<div class="footer text-center">
		<div class="container">COPYRIGHT © 2018 conveyormart.net ALL RIGHTS RESERVED 备案号：沪ICP备11037079号  support：henroad</div>
	</div>
	<section class="zi-fdTel">
		<a href="" target="_onlineqq" class="tel">
			<span class="hide-txt">ＱＱ<br>交谈</span>
			<img class="" src="images/a-14.png">
		</a>
		<a href="javascript:;" class="tel">
			<span class="hide-txt">微信<br>咨询</span>
			<div><img class="" src="images/a-15.png"></div>
			<div class="hide-ewm"><img src="images/fdTel-wx.jpg"><br>扫码微信轻松聊</div>
		</a>
		<a href="" target="_onlinekf" class="tel">
			<span class="hide-txt">在线<br>客服</span>
			<img class="" src="images/a-05.png">
		</a>
		<a href="javascript:;" class="up"><img class="" src="images/a-06.png"><br>顶部</a>
	</section>
</body>
<script src="js/jquery.min.js" type="text/javascript"></script>
<script src="js/bootstrap.min.js" type="text/javascript"></script>
<script src="js/swiper.min.js"></script>
<!-- Initialize Swiper -->
<script type="text/javascript">
	//右侧悬浮
	$(document).ready(function () {

		$('.qtyClass').on('change', function (e) {
			var that = this;
			$.ajax({
				url: '/api/updateQty?cid=' + that.id + '&qty=' + that.value,
				type: 'GET',
				async: false,
				cache: false,
				success: function (data) {
					// console.log(data);
					if (data.status && data.status === 'success') {
						// $(that.parentElement).find('select').html(data.data)
						// debugger;
						location.href = '/cart'
					} else if (data.msg) {
						alert(data.msg)
						// console.log(data.message);
					}
				},
				error: function (data) {
					console.log(data.status);
				}
			});
		})
		$('.btn-remove').click(function (e) {
			this.parentElement.parentElement.remove();
			var that = this;
			$.ajax({
				url: '/api/updateQty?cid=' + that.id + '&isDelete=1',
				type: 'GET',
				async: false,
				cache: false,
				success: function (data) {
					// console.log(data);
					if (data.status && data.status === 'success') {
						// $(that.parentElement).find('select').html(data.data)
						// debugger;
						location.href = '/cart'
					} else if (data.msg) {
						alert(data.msg)
						// console.log(data.message);
					}
				},
				error: function (data) {
					console.log(data.status);
				}
			});
		})
		$('.btn.btn-car').click(function (e) {
			let checks = $('.check');
			let cids = '';
			if (checks && checks.length > 0) {
				for (let j = 0; j < checks.length; j++) {
					// check[j]
					// debugger
					if ($(checks[j]).find('input').val() != 'all') {
						if (checks[j].className.indexOf('active') >= 0) {
							if (cids === '') {
								cids = $(checks[j]).find('input').val();
							}
							else {
								cids = cids + ',' + $(checks[j]).find('input').val();
							}
						}
					}
				}
			}
			$.ajax({
				url: '/api/createOrder?cid=' + cids,
				type: 'GET',
				data: {},
				async: false,
				cache: false,
				contentType: false,
				processData: false,
				success: function (data) {
					console.log(data);
					if (data && data.status && data.status == 'success') {
						// debugger
						// $('.cp-tj-list.hidden-xs').html(data)
						location.href = '/confirmOrder?oid=' + data.oid
					} else if (data.msg) {
						alert(data.msg)
						// console.log(data.message);
					}
				},
				error: function (data) {
					console.log(data.status);
				}
			});

		})
		var checked = function (isAdd, isAll, dom) {
			if (isAdd) {
				if (isAll) {
					var allChecks = $('.check2');
					let all = 0;
					for (let t = 0; t < allChecks.length; t++) {
						if (allChecks[t] && allChecks[t].value) {
							let price = $('.' + allChecks[t].value).val();
							all += parseInt(price)
						}
					}
					$('.totalAmount').html('¥ ' + all)
				}
				else {
					let sid = $(dom).find('input').val();
					let price = $('.' + sid).val();
					var total = /\d+/g.exec($('.totalAmount').html());
					var pr = parseInt(price) + parseInt(total);
					$('.totalAmount').html('¥ ' + pr)
				}
			}
			else {
				if (isAll) {
					$('.totalAmount').html('¥ 0')
				}
				else {
					let sid = $(dom).find('input').val();
					let price = $('.' + sid).val();
					var total = /\d+/g.exec($('.totalAmount').html());
					var pr = parseInt(total) - parseInt(price);
					$('.totalAmount').html('¥ ' + pr)
				}
			}
		}
		$(".check").click(function (e) {

			if (this.className.indexOf('active') >= 0) {
				this.className = this.className.replace('active', '');
				checked(false, $(this).find('input').val() == 'all', this)
			}
			else {
				this.className = this.className + ' active';
				checked(true, $(this).find('input').val() == 'all', this)
			}


			if ($(this).find('input').val() == 'all') {
				if (this.className.indexOf('active') >= 0) {
					let checks = $(".check");
					for (let j = 0; j < checks.length; j++) {
						if (checks[j].className.indexOf('active') < 0) {
							checks[j].className = checks[j].className + ' active'
						}
					}
				}
				else {
					let checks = $(".check");
					for (let j = 0; j < checks.length; j++) {
						if (checks[j].className.indexOf('active') >= 0) {
							checks[j].className = checks[j].className.replace('active', '')
						}
					}
				}
			}
			// debugger;
		})
		$(document).on("click", ".zi-fdTel .up", function () {
			$("html,body").animate({ scrollTop: 0 });
		});
		$(window).scroll(function () {
			var st = $(document).scrollTop();
			var $top = $(".zi-fdTel");
			if (st > 400) {
				$top.css({ display: 'block' });
			} else {
				if ($top.is(":visible")) {
					$top.hide();
				}
			}
		});

	});
	// $(".checkbox").click(function(){
	// 	$(this).toggleClass("active");

	// })
	$(function () {
		var winWide = window.screen.width;

		var wideScreen = false;
		if (winWide >= 768) {

		} else {
			$(".cp-left-tt").click(function () {
				if ($(".cp-left-list").is(":hidden")) {
					$(".cp-left-list").slideDown("slow");
				} else {
					$(".cp-left-list").slideUp("slow");
				}
			});
		}
	})
	$(".navbar-toggle").click(function () {
		$(".nav-down").slideUp("slow");
		if ($(".nav-list").is(":hidden")) {
			$(".nav-list").slideDown("slow");
		} else {
			$(".nav-list").slideUp("slow");
		}
	});
	$(".phone-i").click(function () {
		if ($(this).parents("li").find(".nav-down").is(":hidden")) {
			$(".nav-down").slideUp("slow");
			$(this).parents("li").find(".nav-down").slideDown("slow");
		} else {
			$(this).parents("li").find(".nav-down").slideUp("slow");
		}
	}); 
</script>

</html>